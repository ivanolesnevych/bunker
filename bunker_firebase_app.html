<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Бункер — Онлайн</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 20px; background: #e6e6ff; }
    #container { max-width: 750px; margin: 0 auto; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 16px rgba(0,0,0,0.15); }
    h1 { text-align: center; margin-bottom: 20px; }
    h2 { margin-top: 25px; }
    input, button, select {
      padding: 12px;
      margin: 8px 0;
      width: 100%;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: #4a4aff;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover { background: #3333ff; }
    .player { padding: 10px; background: #f5f5ff; margin: 6px 0; border-radius: 8px; border: 1px solid #ddd; }
    .card { background: #fafaff; padding: 15px; border-radius: 12px; border: 1px solid #ddd; }
  </style>
</head>
<body>
  <div id="container">
    <h1>Бункер — Онлайн</h1>

    <h2>Создать комнату</h2>
    <button id="createRoom">Создать</button>

    <h2>Присоединиться к комнате</h2>
    <input id="roomIdInput" placeholder="ID комнаты" />
    <input id="playerNameInput" placeholder="Ваше имя" />
    <button id="joinRoom">Присоединиться</button>

    <h2>Катастрофа</h2>
    <button id="generateDisaster">Сгенерировать катастрофу</button>
    <div id="disaster" class="card"></div>

    <h2>Игроки</h2>
    <div id="players"></div>

    <h2>Получить характеристики</h2>
    <button id="getStats">Сгенерировать характеристики</button>
    <div id="stats" class="card"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyCIKBfMatEqK8kU1A6bjwAkLF_bUH5HMyg",
  authDomain: "bunker-game-5d55d.firebaseapp.com",
  projectId: "bunker-game-5d55d",
  storageBucket: "bunker-game-5d55d.firebasestorage.app",
  messagingSenderId: "509704920276",
  appId: "1:509704920276:web:e75d3428543af03e75ef41",
  measurementId: "G-43CNKKRPFM"
};

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentRoom = null;
    let playerName = null;

    const createRoomBtn = document.getElementById('createRoom');
    const joinRoomBtn = document.getElementById('joinRoom');
    const getStatsBtn = document.getElementById('getStats');
    const genDisasterBtn = document.getElementById('generateDisaster');

    createRoomBtn.onclick = () => {
      const roomId = Math.random().toString(36).substring(2, 7);
      currentRoom = roomId;
      alert("Комната создана: " + roomId);
      db.ref('rooms/' + roomId).set({ players: {}, disaster: null });
    };

    joinRoomBtn.onclick = () => {
      const roomId = document.getElementById('roomIdInput').value;
      const name = document.getElementById('playerNameInput').value;
      if (!roomId || !name) return alert("Заполните поля");
      currentRoom = roomId;
      playerName = name;

      db.ref(`rooms/${roomId}/players/${name}`).set({ stats: null });

      db.ref(`rooms/${roomId}/players`).on('value', snapshot => {
        const players = snapshot.val() || {};
        const container = document.getElementById('players');
        container.innerHTML = '';
        for (let p in players) {
          const div = document.createElement('div');
          div.className = 'player';
          div.innerText = p + (players[p].stats ? ' — характеристики получены' : '');
          container.appendChild(div);
        }
      });

      db.ref(`rooms/${roomId}/disaster`).on('value', snapshot => {
        const d = snapshot.val();
        document.getElementById('disaster').innerText = d ? d : '';
      });
    };

    const disasters = [
      'Зомби-апокалипсис', 'Глобальная ядерная война', 'Пандемия вируса', 'Падение астероида',
      'Извержение супервулкана', 'Экологический коллапс', 'Восстание ИИ', 'Замерзание Земли'
    ];

    genDisasterBtn.onclick = () => {
      if (!currentRoom) return alert('Создай или войди в комнату');
      const d = disasters[Math.floor(Math.random() * disasters.length)];
      db.ref(`rooms/${currentRoom}`).update({ disaster: d });
    };

    const professions = ['Доктор','Инженер','Биолог','Повар','Охранник','Учёный','Пилот','Строитель'];
    const hobbies = ['Чтение','Рисование','Фитнес','Игры','Рыбалка','Музыка','Плавание'];
    const phobias = ['Темнота','Вода','Высота','Насекомые','Пространства'];
    const bags = ['Нож','Аптечка','Фонарик','Верёвка','Еда','Лопата'];

    function generateStats() {
      return {
        age: Math.floor(Math.random() * 60) + 18,
        profession: professions[Math.floor(Math.random() * professions.length)],
        health: Math.floor(Math.random() * 100) + '%',
        bag: bags[Math.floor(Math.random() * bags.length)],
        phobia: phobias[Math.floor(Math.random() * phobias.length)],
        hobby: hobbies[Math.floor(Math.random() * hobbies.length)],
        fact1: 'Любит приключения',
        fact2: 'Не доверяет незнакомцам'
      };
    }

    getStatsBtn.onclick = () => {
      if (!currentRoom || !playerName) return alert('Вы не в комнате');
      const stats = generateStats();

      document.getElementById('stats').innerHTML = `
        Возраст: ${stats.age}<br>
        Профессия: ${stats.profession}<br>
        Здоровье: ${stats.health}<br>
        Багаж: ${stats.bag}<br>
        Фобия: ${stats.phobia}<br>
        Хобби: ${stats.hobby}<br>
        Интересный факт 1: ${stats.fact1}<br>
        Интересный факт 2: ${stats.fact2}<br>
      `;

      db.ref(`rooms/${currentRoom}/players/${playerName}`).update({ stats });
    };
  </script>
</body>
</html>
